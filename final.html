<!DOCTYPE html>
<!-- å®£å‘Šé€™ä»½æ–‡ä»¶æ˜¯ HTML5 æ¨™æº–æ ¼å¼ï¼Œç¢ºä¿ç€è¦½å™¨ä»¥æ¨™æº–æ¨¡å¼æ¸²æŸ“ç¶²é  -->
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- è¨­å®šè¦–çª—å¯¬åº¦ç­‰æ–¼è£ç½®å¯¬åº¦ï¼Œä¸¦è¨­å®šåˆå§‹ç¸®æ”¾æ¯”ä¾‹ç‚º 1.0ï¼Œç¢ºä¿åœ¨æ‰‹æ©Ÿä¸Šé¡¯ç¤ºæ­£å¸¸ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ™‚é»æ°£çƒ (70ç§’æŒ‘æˆ°)</title>
    <style>
        /* å…¨åŸŸæ¨£å¼è¨­å®š */
        body {
            margin: 0; /* ç§»é™¤ç€è¦½å™¨é è¨­çš„é‚Šè· */
            overflow: hidden; /* éš±è—è¶…å‡ºè¦–çª—çš„å…§å®¹ï¼Œé¿å…å‡ºç¾æ²è»¸ */
            background-color: #2c3e50; /* è¨­å®šèƒŒæ™¯é¡è‰²ç‚ºæ·±è—ç°è‰² */
            font-family: 'Arial', sans-serif; /* è¨­å®šå­—é«” */
            user-select: none; /* ç¦æ­¢ä½¿ç”¨è€…é¸å–æ–‡å­—ï¼Œé¿å…é»æ“Šæ™‚åç™½æ–‡å­—å½±éŸ¿é«”é©— */
            cursor: crosshair; /* å°‡æ»‘é¼ æ¸¸æ¨™æ”¹ç‚ºåå­—æº–å¿ƒå½¢ç‹€ */
        }
        
        /* Canvas è¨­å®š */
        canvas {
            display: block; /* ç§»é™¤ canvas é è¨­çš„ inline å±¬æ€§ç”¢ç”Ÿçš„åº•éƒ¨ç©ºéš™ */
        }

        /* UI ä»‹é¢å±¤ (åˆ†æ•¸èˆ‡æ™‚é–“) */
        #ui-layer {
            position: absolute; /* çµ•å°å®šä½ï¼Œä½¿å…¶æµ®åœ¨ Canvas ä¹‹ä¸Š */
            top: 20px;
            left: 20px;
            right: 20px; /* è¨­å®šå·¦å³è·é›¢ï¼Œè®“å®¹å™¨æ©«è·¨æ•´å€‹å¯¬åº¦ */
            display: flex; /* ä½¿ç”¨ Flexbox æ’ç‰ˆ */
            justify-content: space-between; /* è®“å…§å®¹å¾€å·¦å³å…©é‚Šæ¨ (åˆ†æ•¸é å·¦ï¼Œæ™‚é–“é å³) */
            color: white; /* æ–‡å­—é¡è‰² */
            font-size: 32px; /* å­—é«”å¤§å° */
            font-weight: bold; /* ç²—é«” */
            pointer-events: none; /* é—œéµè¨­å®šï¼šè®“æ»‘é¼ é»æ“Šå¯ä»¥ã€Œç©¿é€ã€é€™å€‹åœ–å±¤é»åˆ°ä¸‹é¢çš„ Canvas */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* æ–‡å­—é™°å½±ï¼Œå¢åŠ å¯è®€æ€§ */
        }

        /* é–‹å§‹/çµæŸç•«é¢ */
        #start-screen {
            position: absolute; /* çµ•å°å®šä½ */
            top: 50%; /* å‚ç›´ç½®ä¸­ */
            left: 50%; /* æ°´å¹³ç½®ä¸­ */
            transform: translate(-50%, -50%); /* ä¿®æ­£ç½®ä¸­åç§»ï¼Œç¢ºä¿æº–ç¢ºå±…ä¸­ */
            text-align: center; /* æ–‡å­—ç½®ä¸­ */
            background: rgba(255, 255, 255, 0.95); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            padding: 50px; /* å…§è· */
            border-radius: 20px; /* åœ“è§’ */
            box-shadow: 0 0 30px rgba(0,0,0,0.5); /* é™°å½±æ•ˆæœ */
            z-index: 10; /* ç¢ºä¿é€™å€‹ç•«é¢åœ¨æœ€ä¸Šå±¤ */
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            background-color: #0984e3;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px; /* è† å›Šç‹€æŒ‰éˆ• */
            cursor: pointer; /* æ»‘é¼ ç§»ä¸Šå»è®Šæˆæ‰‹æŒ‡ */
            margin-top: 20px;
        }

        /* æŒ‰éˆ•äº’å‹•æ•ˆæœ */
        button:hover {
            transform: scale(1.05); /* æ»‘é¼ æ‡¸åœæ™‚ç¨å¾®æ”¾å¤§ */
            background-color: #74b9ff; /* è®Šè‰² */
        }

        /* æ™‚é–“å¿«åˆ°æ™‚çš„è­¦ç¤ºæ¨£å¼ */
        .urgent {
            color: #ff7675; /* ç´…è‰² */
            animation: blink 0.5s infinite; /* å¥—ç”¨é–ƒçˆå‹•ç•« */
        }

        /* å®šç¾©é–ƒçˆå‹•ç•«é—œéµå½±æ ¼ */
        @keyframes blink {
            50% { opacity: 0.5; } /* å‹•ç•«é€²è¡Œåˆ°ä¸€åŠæ™‚è®ŠåŠé€æ˜ */
        }
    </style>
</head>
<body>

    <!-- UI å±¤ï¼šé¡¯ç¤ºåˆ†æ•¸èˆ‡æ™‚é–“ -->
    <div id="ui-layer">
        <div>å¾—åˆ†: <span id="score">0</span></div>
        <div id="timer-display">æ™‚é–“: <span id="time">70</span></div>
    </div>

    <!-- éŠæˆ²ç•«å¸ƒï¼šæ‰€æœ‰çš„æ°£çƒéƒ½åœ¨é€™è£¡ç¹ªè£½ -->
    <canvas id="gameCanvas"></canvas>

    <!-- é–‹å§‹/çµæŸç•«é¢ï¼šéŠæˆ²é–‹å§‹å‰æˆ–çµæŸå¾Œé¡¯ç¤º -->
    <div id="start-screen">
        <h1 id="screen-title">ğŸ¯ é™æ™‚æŒ‘æˆ°</h1>
        <p id="screen-desc">ä½ æœ‰ 70 ç§’çš„æ™‚é–“ï¼Œç›¡å¯èƒ½é»ç ´æ›´å¤šæ°£çƒï¼</p>
        <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        // --- 1. è®Šæ•¸å®£å‘Šèˆ‡åˆå§‹åŒ– ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d'); // å–å¾— 2D ç¹ªåœ–ç’°å¢ƒ
        // å–å¾— DOM å…ƒç´ åƒè€ƒ
        const scoreEl = document.getElementById('score');
        const timeEl = document.getElementById('time');
        const timerDisplay = document.getElementById('timer-display');
        const startScreen = document.getElementById('start-screen');
        const screenTitle = document.getElementById('screen-title');
        const screenDesc = document.getElementById('screen-desc');

        let width, height; // Canvas çš„å¯¬é«˜
        let balloons = []; // å­˜æ”¾æ‰€æœ‰æ°£çƒç‰©ä»¶çš„é™£åˆ—
        let score = 0; // ç•¶å‰åˆ†æ•¸
        let gameActive = false; // éŠæˆ²æ˜¯å¦é€²è¡Œä¸­çš„ç‹€æ…‹æ¨™è¨˜
        let spawnRate = 40; // æ°£çƒç”Ÿæˆé€Ÿç‡ (æ•¸å­—è¶Šå°è¶Šå¿«)
        let frameCount = 0; // ç¸½å¹€æ•¸è¨ˆæ•¸å™¨ï¼Œç”¨ä¾†æ§åˆ¶ç”Ÿæˆæ™‚é–“
        let timeLeft = 70; // å‰©é¤˜æ™‚é–“
        let timerInterval = null; // å­˜æ”¾ setInterval çš„ IDï¼Œç”¨ä¾†æ¸…é™¤è¨ˆæ™‚å™¨

        // --- 2. è¦–çª—å¤§å°èª¿æ•´è™•ç† ---
        function resize() {
            // å°‡ Canvas å¤§å°è¨­å®šç‚ºè¦–çª—çš„å…§éƒ¨å¯¬é«˜ï¼Œç¢ºä¿å…¨è¢å¹•æ»¿ç‰ˆ
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        // ç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®— Canvas å¤§å°
        window.addEventListener('resize', resize);
        resize(); // åˆå§‹åŒ–æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡

        // --- 3. æ°£çƒé¡åˆ¥å®šç¾© (OOP ç‰©ä»¶å°å‘) ---
        class Balloon {
            constructor() {
                // éš¨æ©Ÿè¨­å®šæ°£çƒçš„æœ€å¤§åŠå¾‘ (30px ~ 50px)
                this.maxRadius = Math.random() * 20 + 30;
                this.radius = 0; // åˆå§‹åŠå¾‘ç‚º 0 (ç‚ºäº†åšè®Šå¤§å‹•ç•«)
                // éš¨æ©Ÿä½ç½®ï¼Œä¿ç•™é‚Šè·é¿å…ç”Ÿæˆåœ¨ç•«é¢å¤– (x: 50 ~ width-50, y: 50 ~ height-50)
                this.x = Math.random() * (width - 100) + 50; 
                this.y = Math.random() * (height - 100) + 50;
                // éš¨æ©Ÿé¡è‰² (HSL æ¨¡å¼ï¼šè‰²ç›¸éš¨æ©Ÿï¼Œé£½å’Œåº¦ 70%ï¼Œäº®åº¦ 60%)
                this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
                this.lifeTime = 100; // æ°£çƒå­˜æ´»æ™‚é–“ (å–®ä½ï¼šå¹€)
                this.age = 0; // ç›®å‰å­˜æ´»æ™‚é–“
            }

            // æ›´æ–°æ°£çƒç‹€æ…‹ (æ¯ä¸€å¹€åŸ·è¡Œ)
            update() {
                this.age++;
                // å‰ 10 å¹€åšã€Œè®Šå¤§ã€å‹•ç•«
                if (this.age < 10) {
                    this.radius = this.maxRadius * (this.age / 10);
                } else {
                    this.radius = this.maxRadius;
                }
            }

            // ç¹ªè£½æ°£çƒ (æ¯ä¸€å¹€åŸ·è¡Œ)
            draw() {
                // ç•«æ°£çƒæœ¬é«”
                ctx.beginPath(); // é–‹å§‹æ–°è·¯å¾‘
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); // ç•«åœ“
                ctx.fillStyle = this.color; // è¨­å®šé¡è‰²
                ctx.fill(); // å¡«æ»¿

                // ç•«æ°£çƒçš„é«˜å…‰ (åå…‰æ•ˆæœ)ï¼Œå¢åŠ ç«‹é«”æ„Ÿ
                ctx.beginPath();
                // åå…‰ä½ç½®ç¨å¾®åå·¦ä¸Š
                ctx.arc(this.x - this.radius * 0.3, this.y - this.radius * 0.3, this.radius * 0.2, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)'; // åŠé€æ˜ç™½è‰²
                ctx.fill();
            }
        }

        // --- 4. æ»‘é¼ é»æ“Šäº‹ä»¶è™•ç† ---
        canvas.addEventListener('mousedown', (e) => {
            if (!gameActive) return; // å¦‚æœéŠæˆ²æ²’é–‹å§‹ï¼Œä¸åŸ·è¡Œ

            // å–å¾— Canvas åœ¨é é¢ä¸Šçš„ä½ç½®èˆ‡é»æ“Šåº§æ¨™
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // æª¢æŸ¥æ˜¯å¦é»åˆ°æ°£çƒ (å€’è‘—æª¢æŸ¥ï¼šå…ˆæª¢æŸ¥æœ€ä¸Šå±¤çš„æ°£çƒ)
            for (let i = balloons.length - 1; i >= 0; i--) {
                let b = balloons[i];
                // è¨ˆç®—é»æ“Šé»èˆ‡åœ“å¿ƒçš„è·é›¢ (ç•¢æ°å®šç†)
                let dist = Math.hypot(mouseX - b.x, mouseY - b.y);

                // å¦‚æœè·é›¢ < åŠå¾‘ï¼Œä»£è¡¨é»åˆ°äº†
                if (dist < b.radius) {
                    balloons.splice(i, 1); // å¾é™£åˆ—ä¸­ç§»é™¤è©²æ°£çƒ
                    score++; // åŠ åˆ†
                    scoreEl.innerText = score; // æ›´æ–°ä»‹é¢åˆ†æ•¸

                    // é›£åº¦å¢åŠ æ©Ÿåˆ¶ï¼šæ¯ 5 åˆ†ï¼Œç”Ÿæˆé€Ÿåº¦åŠ å¿« (spawnRate è®Šå°)
                    // ä½¿ç”¨ === ç¢ºä¿åš´æ ¼ç›¸ç­‰
                    if (score % 5 === 0 && spawnRate > 10) {
                        spawnRate -= 2; 
                    }
                    break; // ä¸€æ¬¡é»æ“Šåªç ´ä¸€é¡†ï¼Œè·³å‡ºè¿´åœˆ
                }
            }
        });

        // --- 5. éŠæˆ²æµç¨‹æ§åˆ¶ ---
        
        // é–‹å§‹éŠæˆ²
        function startGame() {
            startScreen.style.display = 'none'; // éš±è—é–‹å§‹ç•«é¢
            gameActive = true; // è¨­å®šç‹€æ…‹ç‚ºé€²è¡Œä¸­
            score = 0;
            scoreEl.innerText = '0';
            spawnRate = 40; // é‡ç½®ç”Ÿæˆé€Ÿç‡
            balloons = []; // æ¸…ç©ºæ°£çƒé™£åˆ—
            timeLeft = 70; // é‡ç½®æ™‚é–“
            timeEl.innerText = timeLeft;
            timerDisplay.classList.remove('urgent'); // ç§»é™¤ç´…è‰²è­¦ç¤º

            // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚å™¨
            if (timerInterval) clearInterval(timerInterval); // é˜²æ­¢é‡è¤‡å•Ÿå‹•
            timerInterval = setInterval(updateTimer, 1000); // æ¯ç§’åŸ·è¡Œä¸€æ¬¡ updateTimer

            animate(); // å•Ÿå‹•å‹•ç•«è¿´åœˆ
        }

        // æ›´æ–°è¨ˆæ™‚å™¨
        function updateTimer() {
            timeLeft--;
            timeEl.innerText = timeLeft;

            // å‰©ä¸‹ 10 ç§’æ™‚ï¼ŒåŠ å…¥è­¦ç¤ºæ¨£å¼
            if (timeLeft <= 10) {
                timerDisplay.classList.add('urgent');
            }

            // æ™‚é–“åˆ°ï¼ŒçµæŸéŠæˆ²
            if (timeLeft <= 0) {
                endGame();
            }
        }

        // çµæŸéŠæˆ²
        function endGame() {
            gameActive = false; // åœæ­¢éŠæˆ²é‚è¼¯
            clearInterval(timerInterval); // æ¸…é™¤è¨ˆæ™‚å™¨
            
            // æ›´æ–°ä¸¦é¡¯ç¤ºçµæŸç•«é¢
            screenTitle.innerText = "æ™‚é–“åˆ°ï¼";
            screenDesc.innerHTML = `ä½ çš„æœ€çµ‚åˆ†æ•¸æ˜¯ï¼š<strong style="font-size:30px; color:#e74c3c">${score}</strong>`;
            document.querySelector('#start-screen button').innerText = "å†ç©ä¸€æ¬¡";
            startScreen.style.display = 'block';
        }

        // --- 6. å‹•ç•«ä¸»è¿´åœˆ (Game Loop) ---
        function animate() {
            if (!gameActive) return; // å¦‚æœéŠæˆ²çµæŸï¼Œåœæ­¢è¿´åœˆ

            // æ¸…é™¤ç•«å¸ƒ (clearRect æ˜¯é—œéµï¼Œé¿å…ç•«é¢ç–ŠåŠ )
            ctx.clearRect(0, 0, width, height);
            
            frameCount++; // å¹€æ•¸è¨ˆæ•¸

            // ç”Ÿæˆæ–°æ°£çƒé‚è¼¯
            // ä½¿ç”¨ % (å–é¤˜æ•¸) ä¾†æ§åˆ¶é »ç‡ï¼Œä¾‹å¦‚ frameCount æ¯å¢åŠ  40 æ‰åŸ·è¡Œä¸€æ¬¡
            if (frameCount % spawnRate === 0) {
                balloons.push(new Balloon());
            }

            // æ›´æ–°ä¸¦ç¹ªè£½æ‰€æœ‰æ°£çƒ
            for (let i = 0; i < balloons.length; i++) {
                balloons[i].update(); // æ›´æ–°åŠå¾‘/å¹´é½¡
                balloons[i].draw(); // ç¹ªè£½

                // ç§»é™¤å£½å‘½çµæŸçš„æ°£çƒ
                if (balloons[i].age >= balloons[i].lifeTime) {
                    balloons.splice(i, 1);
                    i--; // ä¿®æ­£ç´¢å¼•ï¼Œé¿å…è·³éä¸‹ä¸€å€‹å…ƒç´ 
                }
            }

            // è«‹æ±‚ç€è¦½å™¨åŸ·è¡Œä¸‹ä¸€å¹€å‹•ç•« (é€šå¸¸æ¯ç§’ 60 æ¬¡)
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
